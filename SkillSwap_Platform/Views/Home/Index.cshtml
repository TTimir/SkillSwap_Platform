@using System.Linq
@using System.Security.Claims
@inject SkillSwap_Platform.Services.Wishlist.IWishlistService WishlistService
@model SkillSwap_Platform.Models.ViewModels.HomePageVM

@{
    ViewData["Title"] = "Home Page";
}

<style>
    /* 1) make our “equal-height” row a flex container */
    .row.equal-height {
        display: flex;
        flex-wrap: wrap;
    }
        /* 2) ensure each column in that row is also a flex container */
        .row.equal-height > [class*="col-"] {
            display: flex;
        }
            /* 3) force the card itself to grow/fill its column */
            .row.equal-height > [class*="col-"] .listing-style1 {
                flex: 1;
                display: flex;
                flex-direction: column;
            }
        /* 4) clamp all thumbnail imgs to the same height and crop */
        .row.equal-height .list-thumb img {
            height: 180px; /* adjust as you like */
            object-fit: cover;
            width: 100%;
        }
        /* 5) make the textual content flex-grow so footers sit at the bottom */
        .row.equal-height .list-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
            /* 6) push the “budget” (or any bottom meta) to the bottom */
            .row.equal-height .list-content .budget {
                margin-top: auto;
            }

    /* only rows with .swap-grid become flex containers */
    .swap-grid {
        display: flex;
        flex-wrap: wrap;
    }
        /* make each column in .swap-grid a flex container */
        .swap-grid > [class*="col-"] {
            display: flex;
            flex-direction: column;
        }

            /* make the “.item” fill its column */
            .swap-grid > [class*="col-"] .item {
                display: flex;
                flex-direction: column;
                flex: 1; /* ← stretch to fill the column */
            }

                /* then make the card inside .item also stretch */
                .swap-grid > [class*="col-"] .item .listing-style1 {
                    display: flex;
                    flex-direction: column;
                    flex: 1;
                }

        /* finally—push your bottom meta (budget/etc.) down */
        .swap-grid .list-content {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .swap-grid .budget {
            margin-top: auto;
        }

</style>
<!-- Home Banner Style V1 -->
<section class="hero-home14 pt60 pb60 overflow-hidden">
    <div class="container">
        <div class="row align-items-center justify-content-between">
            <div class="col-xl-7">
                <div class="home14-hero-content">
                    <h1 class="title animate-up-1 mb25">Find the right <span>skill</span> <br class="d-none d-xl-block"><span>swap,</span> right away.</h1>
                    <p class="text animate-up-2">Connect with talented peers, swap expertise, and unlock your potential <br class="d-none d-lg-block">because every moment of your time counts.</p>
                    <div class="advance-search-tab bgc-white bdrs60 p10 bdrs4-sm bdr1 position-relative zi9 mt30 animate-up-3">
                        <form method="get" action="@Url.Action("PublicOfferList", "UserOfferDetails")" class="form-search position-relative">
                            <div class="row">
                                <div class="col-md-9 col-lg-10 col-xl-10">
                                    <div class="advance-search-field mb10-sm bdrr1 bdrn-sm">
                                        <div class="box-search">
                                            <span class="icon far fa-magnifying-glass"></span>
                                            <input class="form-control" type="text" name="keyword" placeholder="What are you looking for?">
                                            @* <div class="search-suggestions">
                                                <h6 class="fz14 ml30 mt25 mb-3">Popular Search</h6>
                                                <div class="box-suggestions">
                                                    <ul class="px-0 m-0 pb-4">
                                                        <li>
                                                            <div class="info-product">
                                                                <div class="item_title">mobile app development</div>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div class="info-product">
                                                                <div class="item_title">mobile app builder</div>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div class="info-product">
                                                                <div class="item_title">mobile legends</div>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div class="info-product">
                                                                <div class="item_title">mobile app ui ux design</div>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div class="info-product">
                                                                <div class="item_title">mobile game app development</div>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div class="info-product">
                                                                <div class="item_title">mobile app design</div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div> *@
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-lg-2 col-xl-2">
                                    <div class="text-center text-xl-start">
                                        <button class="ud-btn btn-dark bdrs60 bdrs4-sm w-100 px-0" type="submit">Search</button>
                                    </div>
                                </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-5 d-none d-xl-block">
            <div class="home13-hero-img position-relative">
                <div class="position-relative">
                    <div class="d-flex align-items-center justify-content-end">
                        <div>
                            <img class="img-1 spin-right" src="/template_assets/images/about/element-13.png" alt="">
                            <img class="mb10 wow fadeInLeft" src="/template_assets/images/about/about-14.png" alt="">
                            <div class="funfact_one at-home14-hero-1 mb20-sm py-5 pl35 wow fadeInRight">
                                <div class="details">
                                    <ul class="ps-0 mb-0 d-flex justify-content-start">
                                        <li><div class="timer">@Model.TalentsDisplayValue</div></li>
                                        @if (!String.IsNullOrEmpty(@Model.TalentsSuffix))
                                        {
                                            <li><span>@Model.TalentsSuffix</span></li>
                                        }
                                        <li><span>+</span></li>
                                    </ul>
                                    <p class="text mb-0">
                                        Active Swappers
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="ml10">
                            <div class="funfact_one at-home14-hero-2 mb20 py-5 pl35 wow fadeInLeft">
                                <span class="icon flaticon-rocket"></span>
                                <div class="details">
                                    <ul class="ps-0 mb-0 d-flex justify-content-start">
                                        <li><span>+</span></li>
                                        <li><div class="timer">@Model.ExchangeDisplayValue</div></li>
                                        @if (!String.IsNullOrEmpty(@Model.ExchangeSuffix))
                                        {
                                            <li><span>@Model.ExchangeSuffix</span></li>
                                        }
                                    </ul>
                                    <p class="text mb-0">Swaps Completed</p>
                                </div>
                            </div>
                            <img class="wow fadeInRight" src="/template_assets/images/about/about-15.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>

@if (User != null
  && Model.RecentlyViewedOffers != null
  && Model.RecentlyViewedOffers.Any())
{
    <section class="pt-0 pb100">
        <div class="container">
            <div class="row align-items-center wow fadeInUp">
                <div class="col-lg-9">
                    <div class="main-title">
                        <h2 class="title">Recently Viewed Swap Offers</h2>
                        <p class="paragraph">Jump back into something you were checking out.</p>
                    </div>
                </div>
            </div>

            @await Component.InvokeAsync("RecentOffers", new { offers = Model.RecentlyViewedOffers })
        </div>
    </section>
}

<section class="early-adopters pb60 pt0 text-center">
    <div class="container">
        <h2 class="mb20">Be One of Our Founding SkillSwappers</h2>
        <p class="lead mb30">
            Join us as a founding member and transform your skills into real-world impact!
        </p>
        @if (User?.Identity?.IsAuthenticated == true)
        {
            <a href="@Url.Action("Index", "UserDashboard")"
               class="ud-btn btn-thm">
                Go to Your Dashboard
            </a>
        }
        else
        {
            <a href="@Url.Action("Register", "Home")"
               class="ud-btn btn-thm">
                Sign Up Free
            </a>
        }
    </div>
</section>

@* 
<!-- Our Partners -->
<section class="our-partners pb60 pt-0">
    <div class="container bdrt1">
        <div class="row wow fadeInUp mt60">
            <div class="col-6 col-md-4 col-xl-2">
                <div class="partner_item text-center mb30-lg"><img class="wa m-auto" src="/template_assets/images/partners/13.png" alt="13.png"></div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="partner_item text-center mb30-lg"><img class="wa m-auto" src="/template_assets/images/partners/14.png" alt="14.png"></div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="partner_item text-center mb30-lg"><img class="wa m-auto" src="/template_assets/images/partners/15.png" alt="15.png"></div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="partner_item text-center mb30-lg"><img class="wa m-auto" src="/template_assets/images/partners/16.png" alt="16.png"></div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="partner_item text-center mb30-lg"><img class="wa m-auto" src="/template_assets/images/partners/17.png" alt="17.png"></div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="partner_item text-center mb30-lg"><img class="wa m-auto" src="/template_assets/images/partners/18.png" alt="18.png"></div>
            </div>
        </div>
    </div>
</section>
 *@

<!-- Browse talent by category -->
<section class="pb40-md pb90 bgc-f7">
    <div class="container">
        <div class="row align-items-center wow fadeInUp" data-wow-delay="300ms">
            <div class="col-lg-9">
                <div class="main-title2">
                    <h2 class="title">Browse swap offers by category</h2>
                    <p class="paragraph">Get some Inspirations from @Model.TotalSkills.ToString("N0") skills</p>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="text-start text-lg-end mb-4 mb-lg-2">
                    <a class="ud-btn2" href="@Url.ActionLink("PublicOfferList","UserOfferDetails")">All Categories<i class="fal fa-arrow-right-long"></i></a>
                </div>
            </div>
        </div>
        <div class="row d-none d-lg-flex wow fadeInUp">
            @foreach (var cat in Model.PopularCategories)
            {
                <div class="col-sm-6 col-xl-3">
                    <div class="iconbox-style1 at-home14-v1 default-box-shadow1 overflow-hidden">
                        <div class="icon"><span class="@cat.IconClass"></span></div>
                        <div class="details mt20">
                            <p class="text mb5">@cat.SkillCount.ToString("N0") skills</p>
                            <h5 class="title">@cat.Name</h5>
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="row d-block d-lg-none">
            <div class="col-lg-12">
                <div class="slider-outer-dib navi_pagi_top_right slider-5-grid owl-carousel owl-theme wow fadeInUp">
                    @foreach (var cat in Model.PopularCategories)
                    {
                        <div class="item">
                            <div class="iconbox-style1 bdr1">
                                <div class="icon"><span class="@cat.IconClass"></span></div>
                                <div class="details mt20">
                                    <p class="text mb5">@cat.SkillCount.ToString("N0") skills</p>
                                    <h4 class="title">@cat.Name</h4>
                                    <p class="mb-0">@cat.Description</p>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Need something -->
<section class="our-features pb90 pb30-md">
    <div class="container wow fadeInUp">
        <div class="row">
            <div class="col-lg-12">
                <div class="main-title text-center">
                    <h2>Get It Done with Confidence</h2>
                    <p class="text">Most viewed and all-time popular swap offers</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-lg-3">
                <div class="iconbox-style1 at-home14-v2 after_style p-0 text-center">
                    <div class="icon before-none"><span class="flaticon-cv"></span></div>
                    <div class="details">
                        <h4 class="title mt10 mb-3">Post a Swap Request</h4>
                        <p class="text">Tell us what you need give it a title, a few <br class="d-none d-xxl-block"> bullet points, and your deadline.</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="iconbox-style1 at-home14-v2 after_style p-0 text-center">
                    <div class="icon before-none"><span class="flaticon-web-design"></span></div>
                    <div class="details">
                        <h4 class="title mt10 mb-3">Connect with Swappers</h4>
                        <p class="text">Browse verified profiles, read reviews, and pick <br class="d-none d-xxl-block"> the perfect match for your project. </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="iconbox-style1 at-home14-v2 after_style p-0 text-center">
                    <div class="icon before-none"><span class="flaticon-secure"></span></div>
                    <div class="details">
                        <h4 class="title mt10 mb-3">Secure Token Exchange</h4>
                        <p class="text">We hold your tokens in escrow, release payment <br class="d-none d-xxl-block"> only when you’re 100% happy.</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="iconbox-style1 at-home14-v2 p-0 text-center">
                    <div class="icon before-none"><span class="flaticon-customer-service"></span></div>
                    <div class="details">
                        <h4 class="title mt10 mb-3">We’ve Got Your Back</h4>
                        <p class="text">Our support team is here 24/7 to resolve  <br class="d-none d-xxl-block"> any questions or disputes.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Trending Services -->
<section class="pt-0 pb100">
    <div class="container">
        <div class="row align-items-center wow fadeInUp">
            <div class="col-lg-9">
                <div class="main-title">
                    <h2 class="title">Hot & Trending Swap Offers</h2>
                    <p class="paragraph">See what everyone’s swapping right now</p>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="text-lg-end mb-3">
                    <a href="@Url.Action("PublicOfferList", "UserOfferDetails")" class="ud-btn2">All Swap Offers<i class="fal fa-arrow-right-long"></i></a>
                </div>
            </div>
            <div class="col-xl-9">
                <div class="navpill-style2 at-home9 mb50-lg">
                    <ul class="nav nav-pills mb20 justify-content-xl-end" id="pills-tab" role="tablist">
                        @for (int i = 0; i < Model.TrendingOffersByCategory.Count; i++)
                        {
                            var category = Model.TrendingOffersByCategory[i];
                            bool isActive = (i == 0); // Make the first tab active by default

                            <li class="nav-item" role="presentation">
                                <button class="nav-link @(isActive ? "active" : "") fw500 dark-color"
                                        id="pills-@category.CategorySlug-tab"
                                        data-bs-toggle="pill"
                                        data-bs-target="#pills-@category.CategorySlug"
                                        type="button"
                                        role="tab"
                                        aria-controls="pills-@category.CategorySlug"
                                        aria-selected="@isActive">
                                    @category.CategoryName
                                </button>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </div>
        <div class="row wow fadeInUp" data-wow-delay="300ms">
            <div class="col-lg-12">
                <div class="navpill-style2">
                    <div class="tab-content" id="pills-tabContent">
                        @if (Model.TrendingOffersByCategory != null && Model.TrendingOffersByCategory.Count > 0)
                        {
                            @for (int i = 0; i < Model.TrendingOffersByCategory.Count; i++)
                            {
                                var category = Model.TrendingOffersByCategory[i];
                                bool isActive = (i == 0);

                                <div class="tab-pane fade fz15 text @(isActive ? "show active" : "")"
                                     id="pills-@category.CategorySlug"
                                     role="tabpanel"
                                     aria-labelledby="pills-@category.CategorySlug-tab">

                                    <div class="row equal-height">
                                        @if (category.Offers != null && category.Offers.Any())
                                        {
                                            @foreach (var offer in category.Offers)
                                            {
                                                <div class="col-sm-6 col-xl-3">
                                                    <div class="listing-style1 bdrs16">
                                                        <!-- Image/Portfolio handling -->
                                                        @if (offer.PortfolioImages != null && offer.PortfolioImages.Count > 0)
                                                        {
                                                            <div class="list-thumb">
                                                                <div class="listing-thumbIn-slider position-relative navi_pagi_bottom_center slider-1-grid owl-carousel owl-theme">
                                                                    @foreach (var image in offer.PortfolioImages)
                                                                    {
                                                                        <div class="item">
                                                                            <img class="w-100" src="@image" alt="@offer.Title" />
                                                                            @{
                                                                                // get current user ID
                                                                                var userIdString = Context.User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
                                                                                int userId = 0;
                                                                                if (int.TryParse(userIdString, out var tmp)) userId = tmp;                                                        // check if already in wishlist
                                                                                var inWishlist = userId > 0 && await WishlistService.ExistsAsync(userId, offer.OfferId);
                                                                                bool isSaved = userId > 0
                                                                                && WishlistService.ExistsAsync(userId, offer.OfferId).Result; var title = inWishlist ? "Remove from wishlist" : "Add to wishlist";
                                                                                var addUrl = Url.Action("AddToWishlist", "Wishlist");
                                                                                var removeUrl = Url.Action("RemoveFromWishlist", "Wishlist");
                                                                            }
                                                                            <form asp-controller="UserWishlist"
                                                                                  asp-action="@(isSaved ? "Remove" : "Add")"
                                                                                  method="post"
                                                                                  class="position-absolute"
                                                                                  style="top:8px; right:8px;">
                                                                                @Html.AntiForgeryToken()
                                                                                <input type="hidden" name="offerId" value="@offer.OfferId" />

                                                                                <button type="submit"
                                                                                        class="border-0 listing-fav fz12"
                                                                                        data-bs-toggle="tooltip"
                                                                                        title="@(isSaved ? "Remove from wishlist" : "Add to wishlist")">
                                                                                    <span class="@(isSaved ? "fas fa-heart text-danger" : "far fa-heart")"></span>
                                                                                </button>
                                                                            </form>
                                                                        </div>
                                                                    }
                                                                </div>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            // List of default images.
                                                            var defaultImages = new List<string>
                                                            {
                                                                Url.Content("~/template_assets/images/listings/No_Offer_img_1.jpg"),
                                                                Url.Content("~/template_assets/images/listings/No_Offer_img_2.jpg")
                                                            };

                                                            // Use a deterministic approach:
                                                            int index = offer.OfferId % defaultImages.Count;
                                                            var selectedImage = defaultImages[index];

                                                            <!-- Fallback Image logic if no PortfolioImages exist -->
                                                            <div class="list-thumb">
                                                                <img class="w-100"
                                                                     src="@selectedImage"
                                                                     alt="@offer.Title" />
                                                                @{
                                                                    // get current user ID
                                                                    var userIdString = Context.User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
                                                                    int userId = 0;
                                                                    if (int.TryParse(userIdString, out var tmp)) userId = tmp;                                                        // check if already in wishlist
                                                                    var inWishlist = userId > 0 && await WishlistService.ExistsAsync(userId, offer.OfferId);
                                                                    bool isSaved = userId > 0
                                                                    && WishlistService.ExistsAsync(userId, offer.OfferId).Result; var title = inWishlist ? "Remove from wishlist" : "Add to wishlist";
                                                                    var addUrl = Url.Action("AddToWishlist", "Wishlist");
                                                                    var removeUrl = Url.Action("RemoveFromWishlist", "Wishlist");
                                                                }
                                                                <form asp-controller="UserWishlist"
                                                                      asp-action="@(isSaved ? "Remove" : "Add")"
                                                                      method="post"
                                                                      class="position-absolute"
                                                                      style="top:8px; right:8px;">
                                                                    @Html.AntiForgeryToken()
                                                                    <input type="hidden" name="offerId" value="@offer.OfferId" />

                                                                    <button type="submit"
                                                                            class="border-0 listing-fav fz12"
                                                                            data-bs-toggle="tooltip"
                                                                            title="@(isSaved ? "Remove from wishlist" : "Add to wishlist")">
                                                                        <span class="@(isSaved ? "fas fa-heart text-danger" : "far fa-heart")"></span>
                                                                    </button>
                                                                </form>
                                                            </div>
                                                        }

                                                        <!-- Offer textual details -->
                                                        <div class="list-content">
                                                            <p class="list-text body-color fz14 mb-1">@offer.Category</p>
                                                            <h5 class="list-title">
                                                                <a href="@Url.Action("OfferDetails", "UserOfferDetails", new { offerId = offer.OfferId })">
                                                                    @offer.ShortTitle
                                                                </a>
                                                            </h5>
                                                            <div class="review-meta d-flex align-items-center">
                                                                <i class="fas fa-star fz10 review-color me-2"></i>
                                                                <p class="mb-0 body-color fz14">
                                                                    <span class="dark-color me-2">@offer.AverageRating.ToString("0.00")</span>
                                                                    @offer.ReviewCount reviews
                                                                </p>
                                                            </div>
                                                            <hr class="my-2">
                                                            <div class="list-meta d-flex justify-content-between align-items-center mt15">
                                                                <!-- Example: Link to user profile -->
                                                                <a href="@Url.Action("PublicProfileByUsername", "UserProfile", new { username = offer.UserName })" target="_blank">
                                                                    <span class="position-relative mr10">
                                                                        <img class="rounded-circle"
                                                                             src="@offer.UserProfileImage"
                                                                             width="100"
                                                                             style="max-width:25%"
                                                                             alt="Freelancer Photo" />
                                                                        <!-- Online status example (if you’re handling it) -->
                                                                        <!-- <span class="online-badge"></span> -->
                                                                    </span>
                                                                    <span class="fz14">@offer.UserName</span>
                                                                </a>
                                                                <div class="budget">
                                                                    <p class="mb-0 body-color">
                                                                        Time
                                                                        <span class="fz17 fw500 dark-color ms-1">
                                                                            @offer.TimeCommitmentDays days
                                                                        </span>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <div class="col-12">
                                                <p>No swap offers found for @category.CategoryName.</p>
                                            </div>
                                        }
                                    </div><!-- /.row.equal-height -->
                                </div>

                                <!-- /.tab-pane -->
                            }
                        }
                        else
                        {
                            <p>No trending swap offers available.</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA Banner -->
<section class="p-0">
    <div class="cta-banner3 bgc-thm4 pt120 pt60-lg pb90 pb60-lg position-relative overflow-hidden">
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-xl-5 wow fadeInRight" data-wow-delay="300ms">
                    <div class="mb30">
                        <div class="main-title">
                            <h2 class="title">All the skills you need, <br class="d-none d-xl-block"> one trusted swap away</h2>
                        </div>
                    </div>
                    <div class="why-chose-list pr60 pr0-lg">
                        <div class="list-one d-flex align-items-start mb30">
                            <span class="list-icon flex-shrink-0 flaticon-badge"></span>
                            <div class="list-content flex-grow-1 ml20">
                                <h4 class="mb-1">Verified Swappers</h4>
                                <p class="text mb-0 fz15">See real work samples, peer reviews and identity checks, so you know you’re swapping with pros.</p>
                            </div>
                        </div>
                        <div class="list-one d-flex align-items-start mb30">
                            <span class="list-icon flex-shrink-0 flaticon-money"></span>
                            <div class="list-content flex-grow-1 ml20">
                                <h4 class="mb-1">Swap first, pay later</h4>
                                <p class="text mb-0 fz15">Agree on your exchange, release tokens only when you’re happy, and it’s 100% free to list.</p>
                            </div>
                        </div>
                        <div class="list-one d-flex align-items-start mb30">
                            <span class="list-icon flex-shrink-0 flaticon-security"></span>
                            <div class="list-content flex-grow-1 ml20">
                                <h4 class="mb-1">Secure & transparent</h4>
                                <p class="text mb-0 fz15"> Your tokens protected in escrow and only move when both parties confirm completion, no surprises, ever.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <img class="cta-banner3-img wow fadeInLeft" src="~/template_assets/images/about/about-17.jpg" alt="" data-wow-delay="300ms">
    </div>
</section>

<!-- Highest Rated Freelancers -->
<section class="pb90 pb30-md">
    <div class="container">
        <div class="row align-items-center wow fadeInUp">
            <div class="col-lg-9">
                <div class="main-title">
                    <h2 class="title">Highest Rated Profile</h2>
                    <p class="paragraph">Meet our community’s top-rated swappers</p>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="text-lg-end mb-3">
                    <a href="@Url.Action("PublicProfileList","UserProfileList")" class="ud-btn2">All Swappers <i class="fal fa-arrow-right-long"></i></a>
                </div>
            </div>
        </div>
        <div class="row wow fadeInUp swap-grid" data-wow-delay="300ms">
            @if (Model.HighestRatedFreelancers != null && Model.HighestRatedFreelancers.Count > 0)
            {
                foreach (var freelancer in Model.HighestRatedFreelancers)
                {
                    <div class="col-sm-6 col-xl-3">
                        <div class="item">
                            <div class="listing-style1 text-center style3 offer-card hover-box-shadow">
                                <div class="list-thumb">
                                    <div class="thumb w90 mb20 mt30 mx-auto position-relative rounded-circle">
                                        <img class="rounded-circle mx-auto" src="@freelancer.ProfileImage" alt="@freelancer.Name" style="max-width:100%;" />
                                        <vc:online-indicator user-id="@freelancer.UserId" />
                                    </div>
                                </div>
                                <div class="list-content">
                                    <h5 class="title mb-1">@freelancer.Name</h5>
                                    <p class="mb-1">@freelancer.Designation</p>
                                    <div class="skill-tags d-flex align-items-center justify-content-center mb5">
                                        @{
                                            int count = freelancer.OfferedSkillAreas != null ? freelancer.OfferedSkillAreas.Count : 0;
                                            int maxDisplay = count < 3 ? count : 3;
                                        }
                                        @for (int i = 0; i < maxDisplay; i++)
                                        {
                                            <span class="tag me-2">@freelancer.OfferedSkillAreas[i]</span>
                                        }
                                    </div>

                                    <div class="review">
                                        <p>
                                            <i class="fas fa-star fz10 review-color pr5"></i>
                                            <span class="dark-color fw500">@freelancer.Rating.ToString("0.00")</span> (@freelancer.ReviewCount reviews)
                                        </p>
                                    </div>
                                    <hr class="opacity-100 mt20 mb15">
                                    <div class="fl-meta d-flex align-items-center justify-content-between">
                                        <a class="meta fw500 text-start">
                                            Location<br>
                                            <span class="fz14 fw400">@freelancer.Location</span>
                                        </a>
                                        <a class="meta fw500 text-start">
                                            Recomm.<br>
                                            <span class="fz14 fw400"> @("%")@freelancer.Recommendation</span>
                                        </a>
                                        <a class="meta fw500 text-start">
                                            Exchange Success<br>
                                            <span class="fz14 fw400"> @("%")@freelancer.JobSuccess</span>
                                        </a>
                                    </div>
                                    <div class="d-grid mt15">
                                        <a href="@Url.Action("PublicProfileByUsername", "UserProfile", new { username = freelancer.Name })" class="ud-btn btn-white2 bdrs90">
                                            View Profile <i class="fal fa-arrow-right-long"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="item">
                    <p>No Swappers available.</p>
                </div>
            }
        </div>
    </div>
</section>

<!-- CTA -->
<section class="bgc-dark">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-xl-7">
                <div class="home14-ctaimg-1 mb30-lg position-relative wow fadeInRight">
                    <img class="w-100-lg" src="/template_assets/images/about/about-13.png" alt="">
                    <div class="iconbox-small1 text-start d-flex wow fadeInRight default-box-shadow4 bounce-x animate-up-1">
                        <span class="icon flaticon-badge"></span>
                        <div class="details pl20">
                            <h6 class="mb-1">Proof of quality</h6>
                            <p class="text fz13 mb-0">Only trusted SkillSwappers</p>
                        </div>
                    </div>
                    <div class="iconbox-small2 text-start d-flex wow fadeInLeft default-box-shadow4 bounce-y animate-up-2">
                        <span class="icon flaticon-security"></span>
                        <div class="details pl20">
                            <h6 class="mb-1">Safe and secure</h6>
                            <p class="text fz13 mb-0">Tokens stay safe in escrow</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-5">
                <div class="position-relative wow fadeInLeft">
                    <h2 class="text-white mb35">Join the World’s Premier <br class="d-none d-lg-block"> SkillSwap Community </h2>
                    <p class="text text-white mb35">Tap into a global community of trusted professionals, matched to your needs. With secure escrow, 24/7 support, and flexible swap options (one-off or ongoing), SkillSwap delivers high-impact results, every time.</p>
                    <div class="list-style2 light-style">
                        <ul class="mb30">
                            <li><i class="far fa-check"></i>Work only with proven SkillSwappers who deliver real impact.</li>
                            <li><i class="far fa-check"></i>Precision pairing ensures you find the perfect collaborator.</li>
                            <li><i class="far fa-check"></i>Choose remote, in-person swaps, flexible to your schedule and style.</li>
                        </ul>
                    </div>
                    <a href="@Url.ActionLink("PublicProfileList","UserProfileList")" class="ud-btn btn-white">Find Talent<i class="fal fa-arrow-right-long"></i></a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Learn With SkillSwap -->
<section class="bgc-violet">
    <div class="container">
        <div class="row align-items-md-center">
            <div class="col-md-6 col-lg-8 mb30-md wow fadeInUp" data-wow-delay="100ms">
                <div class="main-title">
                    <h2 class="title">Founding Swappers Making Waves</h2>
                    <p class="paragraph">Early swaps, big impact.</p>
                </div>
                <div class="row">
                    <div class="col-sm-6 col-lg-4">
                        <div class="funfact_one">
                            <div class="details">
                                @{
                                    // format to one decimal place (you can bump to two if you like)
                                    string ratingText = Model.GlobalAverageRating.ToString("0.0");
                                    var parts = ratingText.Split('.');
                                    var whole = parts[0];   // "4"
                                    var fraction = parts.Length > 1 ? parts[1] : "";  // "9"
                                    const int max = 5;
                                }
                                <ul class="ps-0 d-flex mb-0">
                                    <li><div class="timer">@whole</div></li>
                                    @if (!string.IsNullOrEmpty(fraction))
                                    {
                                        <li><div>.</div></li>
                                        @foreach (var digit in fraction)
                                        {
                                            <li><div class="timer">@digit</div></li>
                                        }
                                    }
                                    <li><span>/</span></li>
                                    <li><div class="timer">5</div></li>
                                </ul>
                                <p class="text mb-0">Members rate each other's expertise on SkillSwap</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-4">
                        <div class="funfact_one">
                            <div class="details">
                                <ul class="ps-0 d-flex mb-0">
                                    <li><div class="timer">@Model.SwapSatisfactionPercent</div></li>
                                    <li><span>%</span></li>
                                </ul>
                                <p class="text mb-0">@Model.SwapSatisfactionPercent@("%") of members are satisfied <br> with their swaps</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-4">
                        <div class="funfact_one">
                            <div class="details">
                                <ul class="ps-0 d-flex mb-0">
                                    <li><div class="timer">@Model.EarlyAdopterCount</div></li>
                                    <li><span>+</span></li>
                                </ul>
                                <p class="text mb-0">@Model.EarlyAdopterCount@("+") Early adopters already swapping</p>
                            </div>
                        </div>
                        @* <div class="funfact_one">
                            <div class="details">
                                <h2>Award winner</h2>
                                <p class="text mb-0">Home ownership</p>
                            </div>
                        </div> *@
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-4 col-xl-4">
                <div class="testimonial-slider2 mb15 navi_pagi_bottom_center slider-1-grid owl-carousel owl-theme wow fadeInUp" data-wow-delay="300ms">
                    <div class="item">
                        <div class="testimonial-style1 default-box-shadow1 position-relative bdrs16 mb35">
                            <div class="testimonial-content">
                                <h4 class="title">Instant Swap Fun!</h4>
                                <span class="icon fas fa-quote-left"></span>
                                <h4 class="t_content">“As an early adopter, I posted my first swap in under five minutes, SkillSwap’s launch experience was flawless! ”</h4>
                            </div>
                            <div class="thumb d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    @* <img class="wa" src="/template_assets/images/testimonials/testimonial-1.png" alt=""> *@
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-0">Jevin Talaviya</h6>
                                    <p class="fz14 mb-0">Java Developer</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="testimonial-style1 default-box-shadow1 position-relative bdrs16 mb35">
                            <div class="testimonial-content">
                                <h4 class="title">Worry-Free Protection</h4>
                                <span class="icon fas fa-quote-left"></span>
                                <h4 class="t_content">“The escrow protection gave me peace of mind from day one exchanging tokens has never felt safer. ”</h4>
                            </div>
                            <div class="thumb d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    @* <img class="wa" src="/template_assets/images/testimonials/testimonial-2.png" alt=""> *@
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-0">Smit Bhuva</h6>
                                    <p class="fz14 mb-0">Finance Manager</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="testimonial-style1 default-box-shadow1 position-relative bdrs16 mb35">
                            <div class="testimonial-content">
                                <h4 class="title">Big Impactive</h4>
                                <span class="icon fas fa-quote-left"></span>
                                <h4 class="t_content">“Within days of posting my swap request, I connected with an SEO expert who transformed my website’s traffic. ”</h4>
                            </div>
                            <div class="thumb d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    @* <img class="wa" src="/template_assets/images/testimonials/testimonial-3.png" alt=""> *@
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-0">Arjun M</h6>
                                    <p class="fz14 mb-0">Digital Marketer</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="testimonial-style1 default-box-shadow1 position-relative bdrs16 mb35">
                            <div class="testimonial-content">
                                <h4 class="title">Dashboard Made Easy</h4>
                                <span class="icon fas fa-quote-left"></span>
                                <h4 class="t_content">“Managing swap offers on the new dashboard is effortless everything’s right where you need it, even at launch. ”</h4>
                            </div>
                            <div class="thumb d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    @* <img class="wa" src="/template_assets/images/testimonials/testimonial-4.png" alt=""> *@
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-0">Vatsal Mangukiya</h6>
                                    <p class="fz14 mb-0">Digital Marketer</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="testimonial-style1 default-box-shadow1 position-relative bdrs16 mb35">
                            <div class="testimonial-content">
                                <h4 class="title">Smooth Start</h4>
                                <span class="icon fas fa-quote-left"></span>
                                <h4 class="t_content">“Posting and managing my first swap was so easy huge kudos to SkillSwap for such a smooth launch! ”</h4>
                            </div>
                            <div class="thumb d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    @* <img class="wa" src="/template_assets/images/testimonials/testimonial-5.png" alt=""> *@
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-0">Guatam Nakum</h6>
                                    <p class="fz14 mb-0">Data Analytics</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Skills -->
<section class="pb90 pb30-md">
    <div class="container">
        <div class="row align-items-md-center wow fadeInUp">
            <div class="col-lg-12">
                <div class="home9-navtab-style">
                    <div class="navtab-style2">
                        <nav>
                            <div class="nav nav-tabs mb50" id="nav-tab2" role="tablist">
                                <button class="nav-link active fw600" id="nav-item1-tab" data-bs-toggle="tab" data-bs-target="#nav-item1" type="button" role="tab" aria-controls="nav-item1" aria-selected="true">Top skills</button>
                                <button class="nav-link fw600" id="nav-item2-tab" data-bs-toggle="tab" data-bs-target="#nav-item2" type="button" role="tab" aria-controls="nav-item2" aria-selected="false">Trending skills</button>
                                @* <button class="nav-link fw600" id="nav-item3-tab" data-bs-toggle="tab" data-bs-target="#nav-item3" type="button" role="tab" aria-controls="nav-item3" aria-selected="false">Top skills in @Model.UserCountryName</button> *@
                                <button class="nav-link fw600" id="nav-item3-tab" data-bs-toggle="tab" data-bs-target="#nav-item3" type="button" role="tab" aria-controls="nav-item3" aria-selected="false">Good Swaps to Do</button>
                                <button class="nav-link fw600" id="nav-item4-tab" data-bs-toggle="tab" data-bs-target="#nav-item4" type="button" role="tab" aria-controls="nav-item4" aria-selected="false">Swaps Catalog</button>
                            </div>
                        </nav>
                        @{
                            const int chunkSize = 5;

                            // helper to split any IEnumerable<string> into columns of up to 5 items
                            Func<IEnumerable<string>, List<List<string>>> chunkify = skills =>
                            (skills ?? Enumerable.Empty<string>())
                            .Select((s, i) => new { s, i })
                            .GroupBy(x => x.i / chunkSize)
                            .Select(g => g.Select(x => x.s).ToList())
                            .ToList();

                            @functions {
                                Func<IEnumerable<SkillSwap_Platform.Models.ViewModels.OfferPublicVM.OfferCardVM>,
                                List<List<SkillSwap_Platform.Models.ViewModels.OfferPublicVM.OfferCardVM>>> chunkifyOffers = offers =>
                                (offers ?? Enumerable.Empty<SkillSwap_Platform.Models.ViewModels.OfferPublicVM.OfferCardVM>())
                                .Select((o, i) => new { o, i })
                                .GroupBy(x => x.i / 5)
                                .Select(g => g.Select(x => x.o).ToList())
                                .ToList();
                            }

                            // now build columns for each tab’s data
                            var topSkillCols = chunkify(Model.TopSkills);
                            var trendingSkillCols = chunkify(Model.TrendingSkills);
                            var countrySkillCols = chunkify(Model.TopCountrySkills);
                            var catalogCols = chunkify(Model.ProjectCatalog);
                            var goodSwapCols = chunkifyOffers(Model.GoodSwaps);
                        }
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-item1" role="tabpanel" aria-labelledby="nav-item1-tab">
                                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5">
                                    @foreach (var col in topSkillCols)
                                    {
                                        <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
                                            <ul class="list-unstyled">
                                                @foreach (var skill in col)
                                                {
                                                    <li class="mb10">
                                                        <a asp-controller="UserOfferDetails"
                                                           asp-action="PublicOfferList"
                                                           asp-route-keyword="@skill">
                                                            @skill
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    }
                                </div>
                            </div>
                            <div class="tab-pane fade" id="nav-item2" role="tabpanel" aria-labelledby="nav-item2-tab">
                                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5">
                                    @foreach (var col in trendingSkillCols)
                                    {
                                        <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
                                            <ul class="list-unstyled">
                                                @foreach (var skill in col)
                                                {
                                                    <li class="mb10">
                                                        <a asp-controller="UserOfferDetails"
                                                           asp-action="PublicOfferList"
                                                           asp-route-keyword="@skill">
                                                            @skill
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    }
                                </div>
                            </div>
                            @* <div class="tab-pane fade" id="nav-item3" role="tabpanel" aria-labelledby="nav-item3-tab">
                                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5">
                                    @foreach (var col in countrySkillCols)
                                    {
                                        <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
                                            <ul class="list-unstyled">
                                                @foreach (var skill in col)
                                                {
                                                    <li class="mb10">
                                                        <a asp-controller="UserOfferDetails"
                                                           asp-action="PublicOfferList"
                                                           asp-route-keyword="@skill">
                                                            @skill
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    }
                                </div>
                            </div> *@
                            <div class="tab-pane fade" id="nav-item3" role="tabpanel" aria-labelledby="nav-item3-tab">
                                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5">
                                    @foreach (var col in goodSwapCols)
                                    {
                                        <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
                                            <ul class="list-unstyled">
                                                @foreach (var swap in col)
                                                {
                                                    <li class="mb10">
                                                        <a asp-controller="UserOfferDetails"
                                                           asp-action="OfferDetails"
                                                           asp-route-offerId="@swap.OfferId">
                                                            @swap.ShortTitle
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    }
                                </div>
                            </div>
                            <div class="tab-pane fade" id="nav-item4" role="tabpanel" aria-labelledby="nav-item4-tab">
                                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5">
                                    @foreach (var col in catalogCols)
                                    {
                                        <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
                                            <ul class="list-unstyled">
                                                @foreach (var skill in col)
                                                {
                                                    <li class="mb10">
                                                        <a asp-controller="UserOfferDetails"
                                                           asp-action="PublicOfferList"
                                                           asp-route-keyword="@skill">
                                                            @skill
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
